\documentclass[10pt]{article}
\usepackage{geometry}                
\geometry{a4paper}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{paralist}
\usepackage[parfill]{parskip}

\title{TMA4215 Numerical Mathematics: Project 2 \\ Replace this line with your own title} 
\author{Student nr. 6XXXXX and 7XXXXX} % Here you insert the student number of the members of the group.
\date{\today}

                                          
\begin{document}
\maketitle
\begin{abstract}

Bla bla Her kjem Abstract, men eg berre skriv litt for aa setje av plass til det. \\
Jepsi pepsi \\
Bezier er bra \\
Hurra \\

\end{abstract}

\section{Introduction} 

Bla bla Her kjem Introduction, men eg berre skriv litt for aa setje av plass til det. \\
Jepsi pepsi \\
Bezier er bra \\
Hurra \\
Tralalala \\
Eg er litt gal. \\

\section{Theory}

\subsection*{Bezier curves and Bernstein polynomials}

We have used Bezier curves to approximate a given curve $\gamma$. These are parametrized curves consisting of sums of Bernstein polynomials. A Bernstein polynomial is a polynomial of the form
\begin{align}
B_{i}^n(t) = \binom{n}{i}t^i(t-1)^{(n-i)},\quad i = 0, 1, ..., 0,\quad t \; \in \; [0,1],
\end{align}
and a bezier curve of degree n is given by
\begin{align}
\mathbf{S}(t) = \sum_{i=0}^{n} \mathbf{P_i} B_{i}^n(t), \quad 0 \leq t \leq 1,
\end{align}
where $\mathbf{P}_i$ are so called control. These points are chosen such that $\mathbf{P}_o$ and $\mathbf{P}_n$ are interpolation points between the Bezier curve and $\gamma$. In this report we are using cubic Bezier curves for solving the curve fitting problem, which means that each Bezier curves is made out of 4 points. $\mathbf{P}_0$ and $\mathbf{P}_3$ are starting- and endpoint, and $\mathbf{P}_1$ and $\mathbf{P}_2$ are points giving the curvature.

\subsection*{The least mean square problem}

For the best fit, $\mathbf{P}_1$ and $\mathbf{P}_2$ have to be chosen such that the distance between $\gamma$ and our bezier curve is the small. That is, we needed to minimize the the following expression:

\begin{equation}
E = \frac{1}{m} \sum_{i=1}^{m} \| \mathbf{x}_i - \mathbf{S}(t_i)\|^2_2,
\end{equation}

for parametrization values $t_i \in [ 0,1 ]$ and points $\mathbf{x}_i$ on $\gamma$. To do this we use a property of the Bezier curves: The two straight lines between $\mathbf{P}_0$ and $\mathbf{P}_1$, and $\mathbf{P}_2$ and $\mathbf{P}_3$ are tangents, $\mathbf{v}_0$ and $\mathbf{v}_3$, to the curve at $\mathbf{P}_0$ and $\mathbf{P}_3$ respectively:

\begin{align}
\mathbf{P}_1 = \mathbf{P}_2 + \alpha_1 \mathbf{v}_0 \\
\mathbf{P}_2 = \mathbf{P}_2 + \alpha_2 \mathbf{v}_3
\end{align}

Since $\mathbf{P}_0$ and $\mathbf{P}_3$ are known from the points on the curve $\gamma$, this problem is reduced to finding $\alpha_1$ and $\alpha_2$ such that $E$ is small. We differentiate $E$ with respect to $\alpha_1$ and $\alpha_2$. To ease the reader we omit the whole process, and only state the resulting system of equations for $\alpha_1$ and $\alpha_2$:


\begin{align}
\alpha_1 \sum_{i = 1}^m B_1(t_i)^2 |\mathbf{v}_0|^2 + \alpha_2 \sum_{i = 1}^m B_1(t_i)B_2(t_i)\mathbf{v}_0 \cdot \mathbf{v}_3 
= - \sum_{i = 0}^m B_1(t_i) \mathbf{v}_0 \cdot \mathbf{A}_i, \\
\alpha_1 \sum_{i = 1}^m B_1(t_i)B_2(t_i)\mathbf{v}_0 \cdot \mathbf{v}_3 + \alpha_2 \sum_{i = 1}^m B_2(t_i)^2 |\mathbf{v}_3|^2 
= - \sum_{i = 0}^m B_1(t_i)\mathbf{v}_3 \cdot \mathbf{A}_i,
\end{align}

where $\mathbf{A}_i = \mathbf{P}_0(B_0(t_i) + B_1(t_i) + \mathbf{P}_3(B_3(t_i) + B_2(t_i)) - \mathbf{x}_i$.

\subsection*{Avoiding singular matrices}
When solving the system of equations above, a problem of a singular matrix may arise. We get a singular matrix when the tangent vectors, $\mathbf{v}_0$ and $\mathbf{v}_3$, are parallel, and this happens when the number of points in our subset of points are smaller than 3. This is because the previous described method of choosing tangent vectors will make them parallel if there are no points between them. To avoid this problem we include a space limitation in our algorithm. If the number of elements in a subset of points is smaller then a certain space parameter, we will not divide the curve any further.


To measure the distance between the original curve, $\gamma$, and the Bezier curves, we used the mean square distance 

\begin{equation}
E = \frac{1}{m} \sum_{i=1}^{m} \|\mathbf{x}_i - \mathbf{S}(t_i)\|^2_2,
\end{equation}

where $n$ is the number of points $\mathbf{x}_i$ on the curve. 

parametrization of t
Newton Raphson

\subsection*{Choosing initial $t$-values and Newton-Raphson Iteration}

Choosing the initial $t$-values can be done in many ways. The easiest is probably to generate values ranging from 0 to 1 with equal distance, using the known command "linspace" in MATLAB. But when measuring the distance between $\mathbf{x}_i$ and the respective value $\mathbf{S}(t_i)$, we cannot be sure this is the minimal distance between the Bezier curve and $\gamma$. If we can manage to displace the $t$-values such that the distance between two respective points are minimal, the measured error is much more precise. This can be done using Newton-Raphson iteration. But for this iteration to converge, we need sufficiently good starting values. We use initial $t$-values given by the distance between the data points, $x$ and $y$, from the curve $\gamma$. This method is merely based on \cite{Plass:1983}. Let

\begin{equation}
s_k = \sum_{i=1}^{k-1} \sqrt{(x_{i+1}-x_i)^2 + (y_{i+1}-y_i)^2}
\end{equation}

be the length of the polygonal segment from 1 to $k$, $k$ = 1, 2, ..., $n$. The initial parametric value is then $t_k = s_k/s_n$.

Newton-Raphson is a fixed point iteration method. Our goal is to find $t$-values such that the square distance between $\gamma$ and the Bezier curve, given by the points $X(t)$ and $Y(t)$, is at its smallest. By  differentiating the square distance and equate it to zero, we find its minimum. Let

\begin{align}
f(t) &= \frac{d}{dt} [(X(t)-x)^2 + (Y(t)-y)^2 ] \\
&= 2(X(t)-x)X'(t) + 2(Y(t)-y)Y'(t)
\end{align}

be the differentiated square distance. If Newton-Raphson converges for the initial $t$-values, we will be able to find the root of $f(t) = 0$ with the equation

\begin{equation}
t = t - \frac{f(t)}{f'(t)}.
\end{equation}

This method converges quickly, so few steps are provided for a $t$-value close enough to the root. It is important that the values are still in range 0 to 1, so this needs to be checked after the iterations. 

With the new $t$-values, we can check the error between the Bezier curve and $\gamma$. If the error is still too big, it is a good idea to split the interval in two, and do new approximations for the $t$-values.

\subsection*{Unit tangent vectors}
To find the unit tangent vectors $\mathbf{v}_0$ and $\mathbf{v}_3$, we use the known data points $x$ and $y$ around the endpoints $\mathbf{P}_0$ and $\mathbf{P}_3$. We differ between tangent vectors from corners and tangent vectors that make the curve $C^1$.

A tangent vector that has its origin in a corner will only need data points from one side of the endpoint. That is, the slope of the vector $\mathbf{v}_0$ is measured by $m_0 = (y_{0+r} - y_0)/(x_{0+r} - x_0)$, $r$ being a positive integer denoting the number of data points away from the end point. The unit tangent vector is  $\mathbf{v}_0 = \frac{[1, m_0]^T}{\sqrt{1+m_0^2}}$, where we have divided with the norm. If the denominator in $m_0$ is close to zero, the unit tangent vector might be badly scaled. To avoid this, we recommend $\mathbf{v}_0 = [0,1]$ when $x_{0+r} - x_0$ is below some limit close to zero. 

If the error between a Bezier curve and the original curve is too large, the curve is divided in two, where the dividing point, hereby called $\mathbf{P}_{new}$ becomes a new starting- and endpoint, $\mathbf{P}_0$ and $\mathbf{P}_3$ respectively, for the two Bezier curves. To obtain a curve that is $C^1$, the vector must be the tangent in $\mathbf{P}_{new}$ on the curve, with slope $m_0 = (y_{0+r} - y_{0-r})/(x_{0+r} - x_{0-r})$. The tangent vector $\mathbf{v}_{new} = $









Divide curve in two, recursive, largest distance
Singular matrices
divergent t-values


Tangent vectors
Corners, control points
Number of Bezier curves (Numerical section?
Figures are good!


\section{Numerical experiments}

In this section we will blahblahblah. 



\section{Conclusion}
\cite{Plass:1983}

\bibliographystyle{plain}
\bibliography{bezierbib}   % Insert you own BibTeX file 
\end{document}  
